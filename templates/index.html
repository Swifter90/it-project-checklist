<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Диаграмма Ганта: Запуск IT-проекта</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function filterTasks() {
            const phaseFilter = document.getElementById('phaseFilter').value;
            const teamFilter = document.getElementById('teamFilter').value;
            document.querySelectorAll('.task-row').forEach(row => {
                const phase = row.getAttribute('data-phase');
                const team = row.getAttribute('data-team');
                if ((phaseFilter === '' || phase === phaseFilter) && (teamFilter === '' || team === teamFilter)) {
                    row.style.display = 'block';
                } else {
                    row.style.display = 'none';
                }
            });
        }
    </script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold text-center mb-6">Диаграмма Ганта: Запуск IT-проекта</h1>
        
        {% if error %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
            {{ error }}
        </div>
        {% endif %}

        <form method="POST" class="bg-white shadow-md rounded-lg p-6 mb-6">
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <div>
                    <label class="block text-sm font-semibold">Фильтр по фазе:</label>
                    <select id="phaseFilter" onchange="filterTasks()" class="mt-1 p-2 border rounded w-full sm:w-48">
                        <option value="">Все фазы</option>
                        {% for phase in phases %}
                        <option value="{{ phase }}">{{ phase }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold">Фильтр по команде:</label>
                    <select id="teamFilter" onchange="filterTasks()" class="mt-1 p-2 border rounded w-full sm:w-48">
                        <option value="">Все команды</option>
                        {% for team in teams %}
                        <option value="{{ team }}">{{ team }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-1 gap-4">
                {% for item in checklist %}
                <div class="task-row border-b pb-4" data-phase="{{ item.phase }}" data-team="{{ item.team }}">
                    <p class="font-semibold">{{ item.task }} ({{ item.phase }}, {{ item.team }})</p>
                    <div class="mt-2 flex flex-col sm:flex-row sm:gap-4">
                        <div>
                            <label class="block text-sm">Дата начала:</label>
                            <input type="date" name="start_{{ item.task }}"
                                   value="{{ form_data[item.task].start }}"
                                   class="mt-1 p-2 border rounded w-full sm:w-48 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm">Дата окончания:</label>
                            <input type="date" name="end_{{ item.task }}"
                                   value="{{ form_data[item.task].end }}"
                                   class="mt-1 p-2 border rounded w-full sm:w-48 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm">Прогресс (%):</label>
                            <input type="number" name="progress_{{ item.task }}"
                                   value="{{ form_data[item.task].progress }}"
                                   min="0" max="100"
                                   class="mt-1 p-2 border rounded w-full sm:w-24 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="mt-6 flex gap-4">
                <button type="submit"
                        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
                    Построить диаграмму
                </button>
                {% if pdf_available %}
                <a href="/download_pdf"
                   class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
                    Скачать PDF
                </a>
                {% endif %}
            </div>
        </form>

        {% if graph %}
        <div class="bg-white shadow-md rounded-lg p-6">
            {{ graph | safe }}
        </div>
        {% endif %}
    </div>
</body>
</html>
